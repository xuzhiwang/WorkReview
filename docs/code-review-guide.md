# ä»£ç è¯„å®¡æŒ‡å—

## è¯„å®¡æ¦‚è¿°

ä»£ç è¯„å®¡æ˜¯ä¿è¯ä»£ç è´¨é‡çš„é‡è¦ç¯èŠ‚ï¼Œç‰¹åˆ«æ˜¯å¯¹äºC++è·¨å¹³å°SDKé¡¹ç›®ï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨å†…å­˜å®‰å…¨ã€çº¿ç¨‹å®‰å…¨å’Œè·¨å¹³å°å…¼å®¹æ€§ã€‚

## è¯„å®¡æµç¨‹

### 1. è¯„å®¡å‰å‡†å¤‡

#### å¼€å‘è€…è‡ªæ£€æ¸…å•
- [ ] ä»£ç ç¼–è¯‘æ— è­¦å‘Š
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é™æ€ä»£ç æ£€æŸ¥é€šè¿‡
- [ ] ä»£ç æ ¼å¼åŒ–å®Œæˆ
- [ ] æäº¤ä¿¡æ¯æ¸…æ™°æ˜ç¡®

#### è¯„å®¡è€…å‡†å¤‡
- [ ] äº†è§£éœ€æ±‚èƒŒæ™¯
- [ ] ç†Ÿæ‚‰ç›¸å…³æ¨¡å—
- [ ] å‡†å¤‡è¯„å®¡ç¯å¢ƒ
- [ ] é¢„ç•™å……è¶³æ—¶é—´

### 2. è¯„å®¡æ‰§è¡Œ

#### äº¤å‰è¯„å®¡åˆ¶åº¦
```
è¯„å®¡æµç¨‹:
å¼€å‘è€… â†’ åŒçº§è¯„å®¡è€… â†’ é«˜çº§è¯„å®¡è€… â†’ åˆå¹¶
```

#### è¯„å®¡æ—¶é—´è¦æ±‚
- **å°å‹å˜æ›´** (< 100è¡Œ): 30åˆ†é’Ÿå†…å®Œæˆ
- **ä¸­å‹å˜æ›´** (100-500è¡Œ): 1-2å°æ—¶å®Œæˆ
- **å¤§å‹å˜æ›´** (> 500è¡Œ): åˆ†æ‰¹è¯„å®¡ï¼Œæ¯æ‰¹ä¸è¶…è¿‡500è¡Œ

## C++ä¸“é¡¹è¯„å®¡æ ‡å‡†

### 1. å†…å­˜å®‰å…¨è¯„å®¡

#### 1.1 å†…å­˜ç®¡ç†
```cpp
// âŒ é¿å…è£¸æŒ‡é’ˆ
char* buffer = new char[1024];
// å¿˜è®° delete[] å¯¼è‡´å†…å­˜æ³„æ¼

// âœ… ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ
std::unique_ptr<char[]> buffer = std::make_unique<char[]>(1024);
// è‡ªåŠ¨ç®¡ç†å†…å­˜
```

#### 1.2 RAIIåŸåˆ™æ£€æŸ¥
```cpp
// âŒ æ‰‹åŠ¨èµ„æºç®¡ç†
FILE* file = fopen("test.txt", "r");
if (some_condition) {
    return; // å¿˜è®°å…³é—­æ–‡ä»¶
}
fclose(file);

// âœ… RAIIå°è£…
class FileHandle {
    FILE* file_;
public:
    FileHandle(const char* filename, const char* mode) 
        : file_(fopen(filename, mode)) {}
    ~FileHandle() { if (file_) fclose(file_); }
    FILE* get() const { return file_; }
};
```

#### 1.3 è¾¹ç•Œæ£€æŸ¥
```cpp
// âŒ ç¼ºå°‘è¾¹ç•Œæ£€æŸ¥
void processArray(int* arr, size_t size, size_t index) {
    arr[index] = 42; // å¯èƒ½è¶Šç•Œ
}

// âœ… æ·»åŠ è¾¹ç•Œæ£€æŸ¥
void processArray(int* arr, size_t size, size_t index) {
    if (index >= size) {
        throw std::out_of_range("Index out of bounds");
    }
    arr[index] = 42;
}
```

### 2. çº¿ç¨‹å®‰å…¨è¯„å®¡

#### 2.1 å…±äº«æ•°æ®ä¿æŠ¤
```cpp
// âŒ æœªä¿æŠ¤çš„å…±äº«æ•°æ®
class Counter {
    int count_ = 0;
public:
    void increment() { ++count_; } // ç«æ€æ¡ä»¶
    int get() const { return count_; }
};

// âœ… ä½¿ç”¨äº’æ–¥é”ä¿æŠ¤
class ThreadSafeCounter {
    mutable std::mutex mutex_;
    int count_ = 0;
public:
    void increment() {
        std::lock_guard<std::mutex> lock(mutex_);
        ++count_;
    }
    int get() const {
        std::lock_guard<std::mutex> lock(mutex_);
        return count_;
    }
};
```

#### 2.2 æ­»é”é¢„é˜²æ£€æŸ¥
```cpp
// âŒ å¯èƒ½å¯¼è‡´æ­»é”
class BankAccount {
    std::mutex mutex_;
    double balance_;
public:
    void transfer(BankAccount& to, double amount) {
        std::lock_guard<std::mutex> lock1(mutex_);
        std::lock_guard<std::mutex> lock2(to.mutex_); // æ­»é”é£é™©
        // è½¬è´¦é€»è¾‘
    }
};

// âœ… ä½¿ç”¨std::locké¿å…æ­»é”
void transfer(BankAccount& from, BankAccount& to, double amount) {
    std::lock(from.mutex_, to.mutex_);
    std::lock_guard<std::mutex> lock1(from.mutex_, std::adopt_lock);
    std::lock_guard<std::mutex> lock2(to.mutex_, std::adopt_lock);
    // è½¬è´¦é€»è¾‘
}
```

#### 2.3 åŸå­æ“ä½œä½¿ç”¨
```cpp
// âŒ éåŸå­æ“ä½œ
class Statistics {
    int request_count_ = 0;
public:
    void increment() { ++request_count_; } // éçº¿ç¨‹å®‰å…¨
};

// âœ… ä½¿ç”¨åŸå­æ“ä½œ
class AtomicStatistics {
    std::atomic<int> request_count_{0};
public:
    void increment() { ++request_count_; } // çº¿ç¨‹å®‰å…¨
};
```

### 3. å¼‚å¸¸å®‰å…¨è¯„å®¡

#### 3.1 å¼‚å¸¸å®‰å…¨çº§åˆ«
```cpp
// åŸºæœ¬ä¿è¯: ä¸æ³„æ¼èµ„æº
void basic_guarantee() {
    auto ptr = std::make_unique<Resource>();
    risky_operation(); // å¯èƒ½æŠ›å¼‚å¸¸ï¼Œä½†pträ¼šè‡ªåŠ¨æ¸…ç†
}

// å¼ºä¿è¯: è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆä¿æŒåŸçŠ¶
void strong_guarantee(std::vector<int>& vec) {
    std::vector<int> temp = vec; // å¤åˆ¶
    temp.push_back(42); // å¯èƒ½æŠ›å¼‚å¸¸
    vec = std::move(temp); // ä¸æŠ›å¼‚å¸¸çš„æ“ä½œ
}

// ä¸æŠ›å¼‚å¸¸ä¿è¯
void nothrow_guarantee() noexcept {
    // ä¿è¯ä¸æŠ›å¼‚å¸¸çš„æ“ä½œ
}
```

#### 3.2 å¼‚å¸¸å¤„ç†æ£€æŸ¥
```cpp
// âŒ åæ‰å¼‚å¸¸
try {
    risky_operation();
} catch (...) {
    // ä»€ä¹ˆéƒ½ä¸åšï¼Œéšè—äº†é”™è¯¯
}

// âœ… é€‚å½“çš„å¼‚å¸¸å¤„ç†
try {
    risky_operation();
} catch (const std::exception& e) {
    log_error("Operation failed: " + std::string(e.what()));
    // æ ¹æ®æƒ…å†µå†³å®šæ˜¯å¦é‡æ–°æŠ›å‡º
    throw;
}
```

### 4. æ€§èƒ½ç›¸å…³è¯„å®¡

#### 4.1 ä¸å¿…è¦çš„æ‹·è´
```cpp
// âŒ ä¸å¿…è¦çš„æ‹·è´
void processString(std::string str) { // å€¼ä¼ é€’ï¼Œäº§ç”Ÿæ‹·è´
    // å¤„ç†å­—ç¬¦ä¸²
}

// âœ… ä½¿ç”¨å¼•ç”¨é¿å…æ‹·è´
void processString(const std::string& str) { // å¼•ç”¨ä¼ é€’
    // å¤„ç†å­—ç¬¦ä¸²
}
```

#### 4.2 ç§»åŠ¨è¯­ä¹‰ä½¿ç”¨
```cpp
// âŒ æœªä½¿ç”¨ç§»åŠ¨è¯­ä¹‰
class Container {
    std::vector<std::string> data_;
public:
    void addItem(const std::string& item) {
        data_.push_back(item); // æ€»æ˜¯æ‹·è´
    }
};

// âœ… æ”¯æŒç§»åŠ¨è¯­ä¹‰
class Container {
    std::vector<std::string> data_;
public:
    void addItem(const std::string& item) {
        data_.push_back(item);
    }
    void addItem(std::string&& item) {
        data_.push_back(std::move(item)); // ç§»åŠ¨
    }
};
```

### 5. è·¨å¹³å°å…¼å®¹æ€§è¯„å®¡

#### 5.1 å¹³å°ç‰¹å®šä»£ç 
```cpp
// âŒ ç¡¬ç¼–ç å¹³å°ç‰¹å®šä»£ç 
#ifdef _WIN32
    // Windowsç‰¹å®šä»£ç 
#else
    // å‡è®¾æ˜¯Linuxï¼Œå¯èƒ½åœ¨macOSä¸Šå‡ºé”™
#endif

// âœ… æ˜ç¡®çš„å¹³å°æ£€æŸ¥
#ifdef _WIN32
    // Windowsä»£ç 
#elif defined(__linux__)
    // Linuxä»£ç 
#elif defined(__APPLE__)
    // macOSä»£ç 
#else
    #error "Unsupported platform"
#endif
```

#### 5.2 å­—èŠ‚åºå¤„ç†
```cpp
// âŒ å‡è®¾ç‰¹å®šå­—èŠ‚åº
uint32_t value = *(uint32_t*)buffer; // ä¾èµ–äºå­—èŠ‚åº

// âœ… æ˜ç¡®çš„å­—èŠ‚åºè½¬æ¢
uint32_t value = ntohl(*(uint32_t*)buffer); // ç½‘ç»œå­—èŠ‚åºè½¬ä¸»æœºå­—èŠ‚åº
```

## è¯„å®¡æ£€æŸ¥æ¸…å•

### ä»£ç è´¨é‡æ£€æŸ¥æ¸…å•

#### åŸºç¡€è´¨é‡
- [ ] ä»£ç ç¬¦åˆå›¢é˜Ÿç¼–ç è§„èŒƒ
- [ ] å˜é‡å’Œå‡½æ•°å‘½åæ¸…æ™°æ˜ç¡®
- [ ] æ³¨é‡Šå……åˆ†ä¸”å‡†ç¡®
- [ ] æ²¡æœ‰è°ƒè¯•ä»£ç æ®‹ç•™
- [ ] æ²¡æœ‰TODOæˆ–FIXMEæœªå¤„ç†

#### é€»è¾‘æ­£ç¡®æ€§
- [ ] ç®—æ³•é€»è¾‘æ­£ç¡®
- [ ] è¾¹ç•Œæ¡ä»¶å¤„ç†å®Œæ•´
- [ ] é”™è¯¯å¤„ç†é€‚å½“
- [ ] è¿”å›å€¼æ£€æŸ¥å®Œæ•´
- [ ] è¾“å…¥å‚æ•°éªŒè¯å……åˆ†

#### æ€§èƒ½è€ƒè™‘
- [ ] æ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜
- [ ] ç®—æ³•å¤æ‚åº¦åˆç†
- [ ] å†…å­˜ä½¿ç”¨æ•ˆç‡
- [ ] é¿å…ä¸å¿…è¦çš„è®¡ç®—
- [ ] ç¼“å­˜ç­–ç•¥åˆç†

### C++ç‰¹å®šæ£€æŸ¥æ¸…å•

#### å†…å­˜ç®¡ç†
- [ ] ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†åŠ¨æ€å†…å­˜
- [ ] éµå¾ªRAIIåŸåˆ™
- [ ] æ²¡æœ‰å†…å­˜æ³„æ¼é£é™©
- [ ] æ²¡æœ‰æ‚¬ç©ºæŒ‡é’ˆ
- [ ] æ•°ç»„è¾¹ç•Œæ£€æŸ¥

#### çº¿ç¨‹å®‰å…¨
- [ ] å…±äº«æ•°æ®æœ‰é€‚å½“ä¿æŠ¤
- [ ] é”çš„ä½¿ç”¨æ­£ç¡®
- [ ] æ²¡æœ‰æ­»é”é£é™©
- [ ] åŸå­æ“ä½œä½¿ç”¨æ°å½“
- [ ] çº¿ç¨‹å±€éƒ¨å­˜å‚¨ä½¿ç”¨æ­£ç¡®

#### å¼‚å¸¸å®‰å…¨
- [ ] å¼‚å¸¸å®‰å…¨çº§åˆ«æ˜ç¡®
- [ ] èµ„æºæ¸…ç†ä¿è¯
- [ ] å¼‚å¸¸ä¼ æ’­æ­£ç¡®
- [ ] noexceptä½¿ç”¨æ°å½“
- [ ] å¼‚å¸¸å¤„ç†å®Œæ•´

#### ç°ä»£C++ç‰¹æ€§
- [ ] ä½¿ç”¨autoé€‚å½“
- [ ] èŒƒå›´forå¾ªç¯ä½¿ç”¨
- [ ] ç§»åŠ¨è¯­ä¹‰æ”¯æŒ
- [ ] constexprä½¿ç”¨
- [ ] æ™ºèƒ½æŒ‡é’ˆä¼˜å…ˆ

### æ¶æ„è®¾è®¡æ£€æŸ¥æ¸…å•

#### è®¾è®¡åŸåˆ™
- [ ] å•ä¸€èŒè´£åŸåˆ™
- [ ] å¼€é—­åŸåˆ™
- [ ] ä¾èµ–å€’ç½®åŸåˆ™
- [ ] æ¥å£éš”ç¦»åŸåˆ™
- [ ] æœ€å°çŸ¥è¯†åŸåˆ™

#### æ¨¡å—åŒ–
- [ ] æ¨¡å—èŒè´£æ¸…æ™°
- [ ] æ¥å£è®¾è®¡åˆç†
- [ ] ä¾èµ–å…³ç³»æ¸…æ™°
- [ ] è€¦åˆåº¦é€‚å½“
- [ ] å¯æµ‹è¯•æ€§å¥½

## è¯„å®¡å·¥å…·å’ŒæŠ€æœ¯

### é™æ€åˆ†æå·¥å…·
```bash
# Clang Static Analyzer
scan-build make

# Clang-tidy
clang-tidy src/**/*.cpp -- -std=c++17

# PVS-Studio
pvs-studio-analyzer trace -- make
pvs-studio-analyzer analyze
```

### ä»£ç æ ¼å¼åŒ–
```bash
# clang-format
clang-format -i src/**/*.cpp src/**/*.h

# é…ç½®æ–‡ä»¶ .clang-format
BasedOnStyle: Google
IndentWidth: 4
ColumnLimit: 100
```

### è¯„å®¡è¾…åŠ©å·¥å…·
- **GitHub PRæ¨¡æ¿**: æ ‡å‡†åŒ–PRæè¿°
- **è¯„å®¡æ£€æŸ¥æ¸…å•**: è‡ªåŠ¨åŒ–æ£€æŸ¥é¡¹ç›®
- **ä»£ç è¦†ç›–ç‡**: æµ‹è¯•è¦†ç›–æƒ…å†µ
- **æ€§èƒ½åˆ†æ**: æ€§èƒ½å½±å“è¯„ä¼°

## è¯„å®¡åé¦ˆå’Œæ”¹è¿›

### åé¦ˆåŸåˆ™
1. **å»ºè®¾æ€§**: æä¾›æ”¹è¿›å»ºè®®ï¼Œä¸åªæ˜¯æŒ‡å‡ºé—®é¢˜
2. **å…·ä½“æ€§**: ç»™å‡ºå…·ä½“çš„ä»£ç ç¤ºä¾‹
3. **ä¼˜å…ˆçº§**: åŒºåˆ†å¿…é¡»ä¿®æ”¹å’Œå»ºè®®æ”¹è¿›
4. **æ•™è‚²æ€§**: è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ä¿®æ”¹

### åé¦ˆæ¨¡æ¿
```markdown
## é—®é¢˜ç±»å‹: [ä¸¥é‡/é‡è¦/å»ºè®®]

**ä½ç½®**: æ–‡ä»¶å:è¡Œå·

**é—®é¢˜æè¿°**: 
ç®€è¦æè¿°å‘ç°çš„é—®é¢˜

**å»ºè®®ä¿®æ”¹**: 
æä¾›å…·ä½“çš„ä¿®æ”¹å»ºè®®æˆ–ä»£ç ç¤ºä¾‹

**åŸå› è¯´æ˜**: 
è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·ä¿®æ”¹
```

### æŒç»­æ”¹è¿›
- å®šæœŸå›é¡¾è¯„å®¡æ•ˆæœ
- æ›´æ–°è¯„å®¡æ ‡å‡†å’Œæµç¨‹
- å›¢é˜Ÿè¯„å®¡æŠ€èƒ½åŸ¹è®­
- å·¥å…·å’Œè‡ªåŠ¨åŒ–æ”¹è¿›

---

> ğŸ¯ **ç›®æ ‡**: é€šè¿‡ä¸¥æ ¼çš„ä»£ç è¯„å®¡ï¼Œåœ¨é—®é¢˜è¿›å…¥ç”Ÿäº§ç¯å¢ƒä¹‹å‰å‘ç°å¹¶è§£å†³80%ä»¥ä¸Šçš„æ½œåœ¨é—®é¢˜ã€‚
